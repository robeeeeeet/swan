# 【Web Push 搭載版】PWA 禁煙・減煙アプリ 機能一覧書

## 1\. コンセプト

**「減らすから、やめられる」**
いきなりゼロを目指すのではなく、日々の記録と AI コーチングを通じて徐々に喫煙本数を減らし（減煙）、最終的に無理なく禁煙へと移行するアプリ。

**「先回りする AI パートナー」**
記録による現状把握だけでなく、Web Push 通知を活用して「吸いたくなる瞬間」を予測・警告し、無意識の喫煙を防ぐ。

## 2\. 機能一覧

#### A. 記録・入力機能（Input）

| 機能 ID  | 機能名                                     | 詳細・仕様                                                                                                                                                      | Web Push との連携・役割                                                                                |
| :------- | :----------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------- |
| **A-01** | **「吸った」ボタン**<br>（カウンター）     | 今日の本数をカウントアップするボタン。                                                                                                                          | 事後報告用。即座に記録完了。                                                                           |
| **A-02** | **「吸いたい」ボタン**<br>（SOS / ヘルプ） | **【復活・重要】**<br>吸いたくなった瞬間に押すボタン。<br>これを押すと、\*\*D 群の機能（3 分タイマー、深呼吸、AI 激励など）\*\*がランダムまたは選択で起動する。 | **「魔の時間帯」通知**を受け取ったユーザーが、最初に押すべきボタン。ここから「我慢」のプロセスに入る。 |
| **A-03** | **「我慢できた」ボタン**<br>（成功記録）   | A-02 の機能などを使い、衝動が収まった後に押すボタン。<br>（※A-02 を経由せず、直接押すことも可能）                                                               | 成功体験を記録し、自己肯定感を高める。                                                                 |
| **A-04** | **後からタグ付け**                         | A-01 で吸った際、または A-03 で我慢した際に、その理由（状況）を記録する。                                                                                       | AI 分析の精度向上用。                                                                                  |

### B. ダッシュボード・表示機能（Home）

自分の状況を直感的に把握する画面。

| 機能 ID  | 機能名               | 詳細・仕様                                                       | Web Push との連携・役割                                                                 |
| :------- | :------------------- | :--------------------------------------------------------------- | :-------------------------------------------------------------------------------------- |
| **B-01** | **本数進捗ヘッダー** | 「今日の目標：あと〇本」を常に画面上部に固定表示。               | 通知で「あと〇本です」と知らせた内容を、視覚的にも再確認させる。                        |
| **B-02** | **ランダム Tips**    | 記録ボタン周辺に「水を飲もう」「深呼吸」等の短いテキストを表示。 | （特になし）                                                                            |
| **B-03** | **成果可視化パネル** | 節約金額と「取り戻した寿命」を表示。                             | 節目の金額（例:1,000 円達成）に到達した際、通知でお祝いメッセージを送るトリガーとなる。 |

### C. AI コーチング・分析機能（LLM Logic）

**【最重要】** Web Push を活用し、LLM が能動的にコーチングを行う。

| 機能 ID  | 機能名                         | 詳細・仕様                                                                                                                       | Web Push との連携・役割                                                                                                                |
| :------- | :----------------------------- | :------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------- |
| **C-01** | **モーニング・ブリーフィング** | **【毎朝 指定時間に通知】**<br>AI が昨日の成果を褒め、今日の目標とアドバイスを通知で届ける。<br>タップすると詳細レポートを表示。 | **【Push】** 起床時に通知。「おはようございます！昨日は目標達成でしたね。今日もその調子で！」と朝イチで意識付けを行う。                |
| **C-02** | **魔の時間帯アラート**         | **【危険時間の 10 分前に通知】**<br>過去データから予測される「喫煙確率が高い時間」の直前に警告を送る。                           | **【Push】** 「⚠️ もうすぐ 15 時です。いつもの『仕事疲れの一本』に注意。今のうちにコーヒーを用意して！」と先回りしてブレーキをかける。 |
| **C-03** | **ステップダウン提案**         | 実績に基づき、翌日の目標本数を自動調整して提案する。                                                                             | モーニング・ブリーフィングの通知内に含めるか、アプリ内で表示。                                                                         |
| **C-04** | **生存確認（入力忘れ防止）**   | 長時間記録がない場合に優しく声をかける。                                                                                         | **【Push】** 夕方などに記録がない場合、「お疲れ様です。今日は 0 本ですか？ もし吸っていたら記録をお願いします！」と通知。              |

#### D. 衝動対策・SOS 機能（Support）

※ A-02「吸いたいボタン」が押された時に発動するモード群

| 機能 ID  | 機能名                 | 詳細・仕様                                                                |
| :------- | :--------------------- | :------------------------------------------------------------------------ |
| **D-01** | **3 分間画面タイマー** | A-02 押下時、「まずは 3 分だけ」とカウントダウンを開始する画面。          |
| **D-02** | **深呼吸モード**       | A-02 押下時、アニメーションで呼吸を整えさせる画面。                       |
| **D-03** | **AI の激励/Tips**     | A-02 押下時、「今やめれば〇〇円浮きますよ！」等の強力なメッセージを表示。 |

### E. 履歴・設定（History & Settings）

PWA および Web Push を正しく動作させるための設定。

| 機能 ID  | 機能名                    | 詳細・仕様                                                                               | Web Push との連携・役割                                                     |
| :------- | :------------------------ | :--------------------------------------------------------------------------------------- | :-------------------------------------------------------------------------- |
| **E-01** | **通知設定・許可**        | 通知の ON/OFF、配信時間帯（就寝中は送らない等）の設定。                                  | **【必須】** 初回起動時や設定画面で「通知の許可」をユーザーに求める UI。    |
| **E-02** | **ホーム画面追加ガイド**  | iOS で Web Push を受信するための必須条件（ホーム画面への追加）を案内するチュートリアル。 | これを行わないと iOS では通知が届かないため、初回アクセス時に必ず表示する。 |
| **E-03** | **カレンダー/データ保存** | 過去の履歴表示とデータ保存（DB 連携）。                                                  | バックエンド側で Push 通知のスケジュール管理を行うために必要。              |

---

## 3\. ユーザー体験フロー（Web Push あり）

1.  **【朝】起床 (07:00)**
    - **通知:** 「おはようございます ☀ 昨日は目標達成！ 今日は『14:00』が要注意タイムです。」
    - ユーザー：通知を見て「よし、気をつけよう」と思う。
2.  **【午後】魔の時間帯 直前 (13:50)**
    - **通知:** 「⚠️ もうすぐ魔の 14 時です。イライラしてませんか？ まずは深呼吸を。」
    - ユーザー：仕事の手を止め、通知をタップしてアプリの「深呼吸モード」でリラックスする（1 本回避）。
3.  **【夕方】衝動に負けた時**
    - アプリをホーム画面から開き、即座に「吸った」カウンターを押す。
    - タグ付けで「仕事トラブル」を選択。
4.  **【夜】就寝前**
    - アプリを開き、明日の目標を確認して終了。

## 4\. 開発に必要な技術スタック（Windows 環境）

Windows で開発し、iOS で Push 通知を実現するための構成です。

- **フロントエンド:** Next.js (React) または Vue.js
- **PWA 化:** `next-pwa` などのプラグイン
- **バックエンド (重要):**
  - **Vercel Functions** または **Supabase Edge Functions**
  - 理由: 「指定した時間（朝 7 時や魔の時間帯）に通知を送る」には、サーバー側で定期実行（Cron Job）させる仕組みが必要だからです。
- **通知送信ライブラリ:** `web-push` (Node.js 用ライブラリ)
  - Google/Apple のプッシュ通知サーバーへメッセージを送るために使用します。
- **データベース:** Supabase または Firebase
  - ユーザーごとの「通知購読情報（Endpoint）」と「喫煙ログ」を保存します。

これで、\*\*「Windows で作れて、iPhone で通知が届く」\*\*高機能な禁煙アプリが実現します。

### アプリの画面構成イメージ（修正後）

アプリを開くと、画面中央に大きく 2 つのボタンが並んでいるイメージです。

1.  **🔴 吸いたい (SOS)**
    - **吸う前**に押す。
    - ここからタイマーや Tips へ誘導し、我慢できれば「我慢できた」へ。
    - 我慢できなければ……「吸った」へ（残念）。
2.  **🔵 吸った (Count)**
    - **吸った後**に押す。
    - シンプルに記録。
