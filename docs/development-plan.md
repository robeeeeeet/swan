# Swan PWA ç¦ç…™ãƒ»æ¸›ç…™ã‚¢ãƒ—ãƒª é–‹ç™ºè¨ˆç”»æ›¸

## 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

| é …ç›® | å†…å®¹ |
|------|------|
| ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå | Swanï¼ˆã‚¹ãƒ¯ãƒ³ï¼‰ |
| é–‹ç™ºé–‹å§‹æ—¥ | 2025-11-30 |
| é–‹ç™ºæ–¹å¼ | MVPï¼ˆæœ€å°å®Ÿè¡Œå¯èƒ½è£½å“ï¼‰ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ |

---

## 2. æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

| ã‚«ãƒ†ã‚´ãƒª | æŠ€è¡“ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ |
|---------|------|-----------|
| ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ | Next.js (App Router) | 16.0.5 |
| UI Framework | React | 19.2.0 |
| è¨€èª | TypeScript | 5.x |
| ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚° | Tailwind CSS | 4.x |
| çŠ¶æ…‹ç®¡ç† | Zustand | 5.0.8 |
| ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ | Firebase Firestore | 12.6.0 |
| èªè¨¼ | Firebase Authï¼ˆåŒ¿åèªè¨¼å¯¾å¿œï¼‰ | 12.6.0 |
| Pushé€šçŸ¥ | Firebase Cloud Messaging (FCM) | 12.6.0 |
| AI/LLM | Gemini 2.0 Flash API | - |
| ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚° | Vercelï¼ˆCron Jobsæ´»ç”¨ï¼‰ | - |
| PWA | @ducanh2912/next-pwa (Workbox) | 10.2.9 |

---

## 3. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
swan/
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ icons/              # PWAã‚¢ã‚¤ã‚³ãƒ³ï¼ˆå„ã‚µã‚¤ã‚ºï¼‰
â”‚   â”‚   â”œâ”€â”€ icon-72x72.png
â”‚   â”‚   â”œâ”€â”€ icon-96x96.png
â”‚   â”‚   â”œâ”€â”€ icon-128x128.png
â”‚   â”‚   â”œâ”€â”€ icon-144x144.png
â”‚   â”‚   â”œâ”€â”€ icon-152x152.png
â”‚   â”‚   â”œâ”€â”€ icon-192x192.png
â”‚   â”‚   â”œâ”€â”€ icon-384x384.png
â”‚   â”‚   â”œâ”€â”€ icon-512x512.png
â”‚   â”‚   â””â”€â”€ apple-touch-icon.png
â”‚   â”œâ”€â”€ splash/             # iOSã‚¹ãƒ—ãƒ©ãƒƒã‚·ãƒ¥ã‚¹ã‚¯ãƒªãƒ¼ãƒ³
â”‚   â””â”€â”€ manifest.json       # PWAãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆ
â”œâ”€â”€ app/                    # Next.js App Router (no src/ directory)
â”‚   â”œâ”€â”€ (auth)/             # èªè¨¼é–¢é€£ãƒ«ãƒ¼ãƒˆ
â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â””â”€â”€ onboarding/
â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ (main)/             # ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªãƒ«ãƒ¼ãƒˆ
â”‚   â”‚   â”œâ”€â”€ page.tsx        # ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆãƒ›ãƒ¼ãƒ ï¼‰
â”‚   â”‚   â”œâ”€â”€ history/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”œâ”€â”€ settings/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â””â”€â”€ layout.tsx
â”‚   â”œâ”€â”€ sos/                # SOSãƒ•ãƒ­ãƒ¼ï¼ˆãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ï¼‰
â”‚   â”‚   â”œâ”€â”€ page.tsx        # æˆ¦ç•¥é¸æŠ
â”‚   â”‚   â”œâ”€â”€ timer/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”œâ”€â”€ breathing/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â””â”€â”€ result/
â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ api/                # API Routes
â”‚   â”‚   â”œâ”€â”€ smoke-records/
â”‚   â”‚   â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â”œâ”€â”€ coping-records/
â”‚   â”‚   â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â”œâ”€â”€ statistics/
â”‚   â”‚   â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â”œâ”€â”€ push/
â”‚   â”‚   â”‚   â”œâ”€â”€ subscribe/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â”‚   â””â”€â”€ send/
â”‚   â”‚   â”‚       â””â”€â”€ route.ts
â”‚   â”‚   â”œâ”€â”€ ai/
â”‚   â”‚   â”‚   â”œâ”€â”€ encouragement/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â”‚   â””â”€â”€ coaching/
â”‚   â”‚   â”‚       â””â”€â”€ route.ts
â”‚   â”‚   â””â”€â”€ cron/
â”‚   â”‚       â”œâ”€â”€ morning-briefing/
â”‚   â”‚       â”‚   â””â”€â”€ route.ts
â”‚   â”‚       â””â”€â”€ craving-alert/
â”‚   â”‚           â””â”€â”€ route.ts
â”‚   â”œâ”€â”€ layout.tsx          # ãƒ«ãƒ¼ãƒˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
â”‚   â”œâ”€â”€ globals.css         # ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚¿ã‚¤ãƒ«
â”‚   â””â”€â”€ providers.tsx       # Context Providers
â”œâ”€â”€ components/             # Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ ui/                 # åŸºæœ¬UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ Button.tsx
â”‚   â”‚   â”œâ”€â”€ Card.tsx
â”‚   â”‚   â”œâ”€â”€ Modal.tsx
â”‚   â”‚   â”œâ”€â”€ ProgressRing.tsx
â”‚   â”‚   â”œâ”€â”€ Toast.tsx
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ dashboard/          # ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰é–¢é€£
â”‚   â”‚   â”œâ”€â”€ GoalHeader.tsx
â”‚   â”‚   â”œâ”€â”€ ActionButtons.tsx
â”‚   â”‚   â”œâ”€â”€ AchievementPanel.tsx
â”‚   â”‚   â”œâ”€â”€ RandomTips.tsx
â”‚   â”‚   â””â”€â”€ CounterDisplay.tsx
â”‚   â”œâ”€â”€ sos/                # SOSé–¢é€£
â”‚   â”‚   â”œâ”€â”€ TimerScreen.tsx
â”‚   â”‚   â”œâ”€â”€ BreathingAnimation.tsx
â”‚   â”‚   â”œâ”€â”€ EncouragementMessage.tsx
â”‚   â”‚   â””â”€â”€ StrategySelector.tsx
â”‚   â”œâ”€â”€ records/            # è¨˜éŒ²é–¢é€£
â”‚   â”‚   â”œâ”€â”€ TagSelector.tsx
â”‚   â”‚   â”œâ”€â”€ RecordConfirmation.tsx
â”‚   â”‚   â””â”€â”€ HistoryList.tsx
â”‚   â”œâ”€â”€ settings/           # è¨­å®šé–¢é€£
â”‚   â”‚   â”œâ”€â”€ NotificationSettings.tsx
â”‚   â”‚   â”œâ”€â”€ GoalSettings.tsx
â”‚   â”‚   â””â”€â”€ ProfileSettings.tsx
â”‚   â”œâ”€â”€ pwa/                # PWAé–¢é€£
â”‚   â”‚   â”œâ”€â”€ IOSInstallPrompt.tsx
â”‚   â”‚   â”œâ”€â”€ UpdatePrompt.tsx
â”‚   â”‚   â”œâ”€â”€ OfflineIndicator.tsx
â”‚   â”‚   â””â”€â”€ PushPermissionPrompt.tsx
â”‚   â”œâ”€â”€ animations/         # ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”‚   â”œâ”€â”€ Celebration.tsx
â”‚   â”‚   â””â”€â”€ Confetti.tsx
â”‚   â””â”€â”€ layout/             # ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
â”‚       â”œâ”€â”€ Header.tsx
â”‚       â”œâ”€â”€ BottomNav.tsx
â”‚       â””â”€â”€ SafeArea.tsx
â”œâ”€â”€ hooks/                  # ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯
â”‚   â”œâ”€â”€ useRecords.ts       âœ… å®Ÿè£…æ¸ˆã¿ï¼ˆIndexedDB+Firestoreçµ±åˆï¼‰
â”‚   â”œâ”€â”€ useCopingRecord.ts
â”‚   â”œâ”€â”€ useGoal.ts
â”‚   â”œâ”€â”€ useStatistics.ts
â”‚   â”œâ”€â”€ usePushPermission.ts
â”‚   â”œâ”€â”€ useIOSInstallPrompt.ts
â”‚   â”œâ”€â”€ useOnlineStatus.ts
â”‚   â””â”€â”€ useServiceWorker.ts
â”œâ”€â”€ lib/                    # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ»ã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”œâ”€â”€ firebase/
â”‚   â”‚   â”œâ”€â”€ config.ts       âœ… å®Ÿè£…æ¸ˆã¿
â”‚   â”‚   â”œâ”€â”€ auth.ts         âœ… å®Ÿè£…æ¸ˆã¿
â”‚   â”‚   â””â”€â”€ firestore.ts    âœ… å®Ÿè£…æ¸ˆã¿ï¼ˆCRUDæ“ä½œãƒ•ãƒ«å®Ÿè£…ï¼‰
â”‚   â”œâ”€â”€ indexeddb/          # IndexedDBï¼ˆã‚ªãƒ•ãƒ©ã‚¤ãƒ³ç”¨ï¼‰âœ… å®Ÿè£…æ¸ˆã¿
â”‚   â”‚   â”œâ”€â”€ db.ts           âœ… ã‚¹ã‚­ãƒ¼ãƒå®šç¾©ãƒ»DBåˆæœŸåŒ–
â”‚   â”‚   â”œâ”€â”€ records.ts      âœ… å–«ç…™è¨˜éŒ²CRUD
â”‚   â”‚   â”œâ”€â”€ summaries.ts    âœ… ã‚µãƒãƒªãƒ¼CRUD
â”‚   â”‚   â”œâ”€â”€ settings.ts     âœ… è¨­å®šCRUD
â”‚   â”‚   â”œâ”€â”€ sync.ts         âœ… åŒæœŸã‚­ãƒ¥ãƒ¼ç®¡ç†
â”‚   â”‚   â””â”€â”€ index.ts        âœ… çµ±åˆãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆoffline-firstï¼‰
â”‚   â”œâ”€â”€ push/
â”‚   â”‚   â”œâ”€â”€ config.ts
â”‚   â”‚   â””â”€â”€ client.ts
â”‚   â”œâ”€â”€ ai/
â”‚   â”‚   â”œâ”€â”€ gemini.ts
â”‚   â”‚   â””â”€â”€ prompts.ts
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ date.ts         âœ… å®Ÿè£…æ¸ˆã¿
â”‚       â””â”€â”€ summary.ts      âœ… å®Ÿè£…æ¸ˆã¿ï¼ˆçµ±è¨ˆè¨ˆç®—ãƒ»ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼‰
â”œâ”€â”€ store/                  # Zustand ã‚¹ãƒˆã‚¢
â”‚   â”œâ”€â”€ useUserStore.ts
â”‚   â”œâ”€â”€ useRecordStore.ts
â”‚   â””â”€â”€ useSettingsStore.ts
â”œâ”€â”€ types/                  # TypeScriptå‹å®šç¾©
â”‚   â”œâ”€â”€ smoke-record.ts
â”‚   â”œâ”€â”€ coping-record.ts
â”‚   â”œâ”€â”€ user.ts
â”‚   â”œâ”€â”€ notification.ts
â”‚   â””â”€â”€ api.ts
â”œâ”€â”€ constants/              # å®šæ•°
â”‚   â”œâ”€â”€ tags.ts
â”‚   â”œâ”€â”€ tips.ts
â”‚   â””â”€â”€ encouragement.ts
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ unit/
â”‚   â”œâ”€â”€ integration/
â”‚   â””â”€â”€ e2e/
â”œâ”€â”€ .env.local              # ç’°å¢ƒå¤‰æ•°ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ï¼‰
â”œâ”€â”€ .env.example            # ç’°å¢ƒå¤‰æ•°ã‚µãƒ³ãƒ—ãƒ«
â”œâ”€â”€ next.config.js          # Next.jsè¨­å®š
â”œâ”€â”€ tailwind.config.js      # Tailwindè¨­å®š
â”œâ”€â”€ tsconfig.json           # TypeScriptè¨­å®š
â”œâ”€â”€ package.json
â”œâ”€â”€ vercel.json             # Vercelè¨­å®šï¼ˆCronç­‰ï¼‰
â””â”€â”€ firebase.json           # Firebaseè¨­å®š
```

---

## 4. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### 4.1 Firestore ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³æ§‹é€ 

```
firestore/
â”œâ”€â”€ users/{userId}/
â”‚   â”œâ”€â”€ profile             # ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«
â”‚   â”œâ”€â”€ settings            # ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®š
â”‚   â”œâ”€â”€ pushSubscriptions/  # Pushè³¼èª­æƒ…å ±
â”‚   â”‚   â””â”€â”€ {subscriptionId}
â”‚   â”œâ”€â”€ smokeRecords/       # å–«ç…™è¨˜éŒ²
â”‚   â”‚   â””â”€â”€ {recordId}
â”‚   â”œâ”€â”€ copingRecords/      # å¯¾å‡¦è¨˜éŒ²
â”‚   â”‚   â””â”€â”€ {recordId}
â”‚   â””â”€â”€ dailyStats/         # æ—¥åˆ¥çµ±è¨ˆ
â”‚       â””â”€â”€ {YYYY-MM-DD}
```

### 4.2 ã‚¹ã‚­ãƒ¼ãƒå®šç¾©

```typescript
// users/{userId}/profile
interface UserProfile {
  id: string;
  createdAt: Timestamp;
  updatedAt: Timestamp;
  displayName?: string;
  cigarettePricePerPack: number;    // 1ç®±ã‚ãŸã‚Šã®ä¾¡æ ¼ï¼ˆå††ï¼‰
  cigarettesPerPack: number;         // 1ç®±ã‚ãŸã‚Šã®æœ¬æ•°
  dailyAverage?: number;             // ç¦ç…™å‰ã®1æ—¥å¹³å‡æœ¬æ•°
  quitStartDate?: Timestamp;         // æ¸›ç…™é–‹å§‹æ—¥
  timezone: string;                  // ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³
}

// users/{userId}/settings
interface UserSettings {
  id: string;
  updatedAt: Timestamp;
  dailyGoal: number;                 // 1æ—¥ã®ç›®æ¨™æœ¬æ•°
  goalAutoAdjust: boolean;           // è‡ªå‹•èª¿æ•´æœ‰åŠ¹
  notificationEnabled: boolean;
  morningBriefingTime: string;       // HH:MMå½¢å¼
  morningBriefingEnabled: boolean;
  cravingAlertEnabled: boolean;
  cravingAlertMinutesBefore: number;
  reminderEnabled: boolean;
  quietHoursStart: string;
  quietHoursEnd: string;
}

// users/{userId}/smokeRecords/{recordId}
interface SmokeRecord {
  id: string;
  createdAt: Timestamp;
  timestamp: Timestamp;
  type: 'smoked' | 'resisted';
  tag?: string;
  note?: string;
  cravingRecordId?: string;
  localId: string;                   // ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œç”¨
}

// users/{userId}/copingRecords/{recordId}
interface CopingRecord {
  id: string;
  createdAt: Timestamp;
  timestamp: Timestamp;
  strategy: 'timer' | 'breathing' | 'tips' | 'other';
  durationSeconds: number;
  success: boolean;
  smokeRecordId?: string;
  localId: string;
}

// users/{userId}/dailyStats/{date}
interface DailyStats {
  date: string;                      // YYYY-MM-DD
  smokedCount: number;
  resistedCount: number;
  cravingCount: number;
  goal: number;
  goalAchieved: boolean;
  moneySaved: number;
  tags: Record<string, number>;
  updatedAt: Timestamp;
}
```

### 4.3 IndexedDB ã‚¹ã‚­ãƒ¼ãƒï¼ˆã‚ªãƒ•ãƒ©ã‚¤ãƒ³ç”¨ï¼‰âœ… å®Ÿè£…å®Œäº†ï¼ˆ2025-11-30ï¼‰

**å®Ÿè£…æ¸ˆã¿ã‚¹ã‚­ãƒ¼ãƒ:**

```typescript
// Database: SwanDB (version 1)
// Location: lib/indexeddb/db.ts

export const STORES = {
  RECORDS: 'records',      // å–«ç…™è¨˜éŒ²ï¼ˆSmokingRecordå‹ï¼‰
  SUMMARIES: 'summaries',  // æ—¥åˆ¥ã‚µãƒãƒªãƒ¼ï¼ˆDailySummaryå‹ï¼‰
  SETTINGS: 'settings',    // ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šï¼ˆUserSettingså‹ï¼‰
  SYNC_QUEUE: 'syncQueue', // ã‚ªãƒ•ãƒ©ã‚¤ãƒ³åŒæœŸã‚­ãƒ¥ãƒ¼ï¼ˆSyncQueueItemå‹ï¼‰
} as const;

// records ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆã‚¢
interface SmokingRecord {
  id: string;              // ã‚­ãƒ¼: userId_timestamp
  userId: string;
  type: 'smoked' | 'craved' | 'resisted';
  timestamp: number;       // Unixã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ï¼ˆãƒŸãƒªç§’ï¼‰
  date: string;            // YYYY-MM-DDå½¢å¼
  tags: SituationTag[];    // çŠ¶æ³ã‚¿ã‚°é…åˆ—
}
// Indexes: userId, timestamp, date, type

// summaries ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆã‚¢
interface DailySummary {
  id: string;              // ã‚­ãƒ¼: userId_YYYY-MM-DD
  userId: string;
  date: string;
  totalSmoked: number;
  totalCraved: number;
  totalResisted: number;
  moneySaved: number;
  minutesSaved: number;
  mostCommonTags: SituationTag[];
  dailyTarget: number;
  goalMet: boolean;
  resistanceRate: number;
}
// Indexes: userId, date

// settings ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆã‚¢
interface UserSettings {
  userId: string;          // ã‚­ãƒ¼
  notifications: NotificationSettings;
  goals: GoalSettings;
  app: AppSettings;
}
// Indexes: ãªã—ï¼ˆuserIdãŒã‚­ãƒ¼ï¼‰

// syncQueue ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆã‚¢
interface SyncQueueItem {
  id: string;              // ã‚­ãƒ¼: storeName_operation_documentId_timestamp
  storeName: string;       // å¯¾è±¡ã‚¹ãƒˆã‚¢å
  operation: 'create' | 'update' | 'delete';
  documentId: string;      // Firestore document ID
  data?: any;              // åŒæœŸã™ã‚‹ãƒ‡ãƒ¼ã‚¿ï¼ˆdeleteã¯ä¸è¦ï¼‰
  timestamp: number;       // ã‚­ãƒ¥ãƒ¼è¿½åŠ æ™‚åˆ»
  retries: number;         // ãƒªãƒˆãƒ©ã‚¤å›æ•°ï¼ˆæœ€å¤§3å›ï¼‰
  lastError?: string;      // æœ€å¾Œã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
}
// Indexes: timestamp, storeName
```

**å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½:**
- âœ… ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å„ªå…ˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ˆIndexedDB â†’ Firestoreï¼‰
- âœ… è‡ªå‹•åŒæœŸã‚­ãƒ¥ãƒ¼ï¼ˆã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¾©å¸°æ™‚ã«å‡¦ç†ï¼‰
- âœ… é‡è¤‡æ’é™¤æ©Ÿèƒ½ï¼ˆåŒä¸€æ–‡æ›¸ã®è¤‡æ•°æ“ä½œã‚’æœ€æ–°ã®ã¿ã«é›†ç´„ï¼‰
- âœ… ãƒªãƒˆãƒ©ã‚¤æ©Ÿæ§‹ï¼ˆæœ€å¤§3å›ã€å¤±æ•—æ™‚ã¯ã‚¨ãƒ©ãƒ¼è¨˜éŒ²ï¼‰
- âœ… ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰åŒæœŸï¼ˆwindow.onlineã‚¤ãƒ™ãƒ³ãƒˆã§è‡ªå‹•å®Ÿè¡Œï¼‰

---

## 5. APIè¨­è¨ˆ

| ãƒ¡ã‚½ãƒƒãƒ‰ | ãƒ‘ã‚¹ | èª¬æ˜ | èªè¨¼ |
|---------|------|------|------|
| POST | /api/smoke-records | å–«ç…™/æˆ‘æ…¢è¨˜éŒ²ã‚’ä½œæˆ | å¿…é ˆ |
| GET | /api/smoke-records | è¨˜éŒ²ä¸€è¦§ã‚’å–å¾— | å¿…é ˆ |
| GET | /api/smoke-records/today | ä»Šæ—¥ã®è¨˜éŒ²ã‚’å–å¾— | å¿…é ˆ |
| DELETE | /api/smoke-records/{id} | è¨˜éŒ²ã‚’å‰Šé™¤ | å¿…é ˆ |
| POST | /api/coping-records | å¯¾å‡¦è¨˜éŒ²ã‚’ä½œæˆ | å¿…é ˆ |
| GET | /api/statistics | çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã‚’å–å¾— | å¿…é ˆ |
| GET | /api/statistics/daily | æ—¥åˆ¥çµ±è¨ˆã‚’å–å¾— | å¿…é ˆ |
| POST | /api/push/subscribe | Pushé€šçŸ¥ã‚’è³¼èª­ | å¿…é ˆ |
| DELETE | /api/push/unsubscribe | Pushé€šçŸ¥ã‚’è§£é™¤ | å¿…é ˆ |
| POST | /api/ai/encouragement | AIåŠ±ã¾ã—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆ | å¿…é ˆ |
| POST | /api/ai/coaching | AIã‚³ãƒ¼ãƒãƒ³ã‚° | å¿…é ˆ |
| POST | /api/cron/morning-briefing | æœã®ãƒ–ãƒªãƒ¼ãƒ•ã‚£ãƒ³ã‚°ï¼ˆCronï¼‰ | Cron |
| POST | /api/cron/craving-alert | é­”ã®æ™‚é–“å¸¯ã‚¢ãƒ©ãƒ¼ãƒˆï¼ˆCronï¼‰ | Cron |

---

## 6. é–‹ç™ºãƒ•ã‚§ãƒ¼ã‚º

### Phase 1: MVPåŸºç›¤ï¼ˆWeek 1-2ï¼‰

**ç›®æ¨™:** åŸºæœ¬çš„ãªè¨˜éŒ²æ©Ÿèƒ½ã¨å³åº§ã«ä¾¡å€¤ã‚’æä¾›ã™ã‚‹SOSæ©Ÿèƒ½

#### Week 1: ç’°å¢ƒæ§‹ç¯‰ + åŸºæœ¬UI

| ã‚¿ã‚¹ã‚¯ | æˆæœç‰© |
|--------|--------|
| Next.js + Tailwind + TypeScriptåˆæœŸåŒ– | å‹•ä½œã™ã‚‹Next.jsã‚¢ãƒ—ãƒª |
| Firebase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆãƒ»è¨­å®š | Firebaseæ¥ç¶šå®Œäº† |
| èªè¨¼å®Ÿè£…ï¼ˆåŒ¿å + Googleï¼‰ | ãƒ­ã‚°ã‚¤ãƒ³/ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ©Ÿèƒ½ |
| Swan Design Systemå®Ÿè£… | Tailwindè¨­å®šå®Œäº† |
| åŸºæœ¬UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆButton, Card, Modalï¼‰ | ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒª |
| ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒšãƒ¼ã‚¸å®Ÿè£…ï¼ˆA-01, A-02, B-01ï¼‰ | ãƒ›ãƒ¼ãƒ ç”»é¢ |

#### Week 2: è¨˜éŒ²æ©Ÿèƒ½ + ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–å±¤ âœ… å®Œäº†ï¼ˆ2025-11-30ï¼‰

| ã‚¿ã‚¹ã‚¯ | æˆæœç‰© | çŠ¶æ…‹ |
|--------|--------|------|
| IndexedDB ã‚¹ã‚­ãƒ¼ãƒè¨­è¨ˆãƒ»å®Ÿè£… | `lib/indexeddb/db.ts` | âœ… å®Œäº† |
| IndexedDB CRUDæ“ä½œå®Ÿè£… | `lib/indexeddb/{records,summaries,settings}.ts` | âœ… å®Œäº† |
| ã‚ªãƒ•ãƒ©ã‚¤ãƒ³åŒæœŸã‚­ãƒ¥ãƒ¼å®Ÿè£… | `lib/indexeddb/sync.ts` | âœ… å®Œäº† |
| Firestore CRUDæ“ä½œå®Ÿè£… | `lib/firebase/firestore.ts` | âœ… å®Œäº† |
| çµ±åˆãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¤ãƒ¤ãƒ¼å®Ÿè£… | `lib/indexeddb/index.ts` (offline-first) | âœ… å®Œäº† |
| ã‚µãƒãƒªãƒ¼è¨ˆç®—ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ | `lib/utils/summary.ts` | âœ… å®Œäº† |
| useRecords ãƒ•ãƒƒã‚¯å®Ÿè£… | `hooks/useRecords.ts` | âœ… å®Œäº† |
| ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰çµ±åˆãƒ»å‹•ä½œç¢ºèª | `app/(main)/dashboard/page.tsx` | âœ… å®Œäº† |
| ã€Œå¸ã£ãŸã€ãƒœã‚¿ãƒ³æ©Ÿèƒ½å®Ÿè£…ï¼ˆA-01ï¼‰ | ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼æ©Ÿèƒ½ | âœ… å®Œäº† |
| ã‚¿ã‚°é¸æŠUIå®Ÿè£…ï¼ˆA-04ï¼‰ | ã‚¿ã‚°ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ | âœ… å®Œäº† |
| ã€Œæˆ‘æ…¢ã§ããŸã€ãƒœã‚¿ãƒ³æ©Ÿèƒ½å®Ÿè£…ï¼ˆA-03ï¼‰ | æˆåŠŸè¨˜éŒ²æ©Ÿèƒ½ | âœ… å®Œäº† |

#### Week 3: SOSæ©Ÿèƒ½ âœ… å®Œäº†ï¼ˆ2025-11-30ï¼‰

| ã‚¿ã‚¹ã‚¯ | æˆæœç‰© | çŠ¶æ…‹ |
|--------|--------|------|
| SOSç”»é¢å®Ÿè£…ï¼ˆD-01: 3åˆ†ã‚¿ã‚¤ãƒãƒ¼ï¼‰ | ã‚¿ã‚¤ãƒãƒ¼ç”»é¢ | âœ… å®Œäº† |
| æ·±å‘¼å¸ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…ï¼ˆD-02ï¼‰ | å‘¼å¸ã‚¬ã‚¤ãƒ‰ç”»é¢ | âœ… å®Œäº† |
| ç¥ç¦ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£… | Celebration ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | âœ… å®Œäº† |
| SOSãƒ¢ãƒ¼ãƒ€ãƒ«çµ±åˆ | SOSModal ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | âœ… å®Œäº† |

#### Week 4: å±¥æ­´ãƒšãƒ¼ã‚¸å®Ÿè£… âœ… å®Œäº†ï¼ˆ2025-11-30ï¼‰

| ã‚¿ã‚¹ã‚¯ | æˆæœç‰© | çŠ¶æ…‹ |
|--------|--------|------|
| useHistory ãƒ•ãƒƒã‚¯å®Ÿè£… | `hooks/useHistory.ts` | âœ… å®Œäº† |
| æ—¥åˆ¥ã‚µãƒãƒªãƒ¼ã‚«ãƒ¼ãƒ‰å®Ÿè£… | `components/history/HistoryCard.tsx` | âœ… å®Œäº† |
| é€±é–“çµ±è¨ˆã‚«ãƒ¼ãƒ‰å®Ÿè£… | `components/history/WeekStats.tsx` | âœ… å®Œäº† |
| æœ¬æ•°æ¨ç§»ãƒãƒ£ãƒ¼ãƒˆå®Ÿè£… | `components/history/SimpleBarChart.tsx` | âœ… å®Œäº† |
| æ—¥åˆ¥è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ«å®Ÿè£… | `components/history/DayDetailModal.tsx` | âœ… å®Œäº† |
| å±¥æ­´ãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸å®Ÿè£… | `app/(main)/history/page.tsx` | âœ… å®Œäº† |
| ã‚µãƒãƒªãƒ¼è¨ˆç®—é–¢æ•°æ‹¡å¼µ | `formatDate()`, `formatTime()` è¿½åŠ  | âœ… å®Œäº† |

**Phase 1 å®Œäº†æ©Ÿèƒ½ï¼ˆ2025-11-30 å®Œå…¨å®Œäº†ï¼‰:**
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ï¼ˆåŒ¿åèªè¨¼ï¼‰
- âœ… å–«ç…™è¨˜éŒ²ï¼ˆã€Œå¸ã£ãŸã€ãƒœã‚¿ãƒ³ + ã‚¿ã‚°ï¼‰
- âœ… æˆ‘æ…¢æˆåŠŸè¨˜éŒ²ï¼ˆã€Œæˆ‘æ…¢ã§ããŸã€ãƒœã‚¿ãƒ³ + ã‚¿ã‚°ï¼‰
- âœ… ä»Šæ—¥ã®ã‚«ã‚¦ãƒ³ãƒˆè¡¨ç¤º
- âœ… ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œï¼ˆIndexedDB + è‡ªå‹•åŒæœŸï¼‰
- âœ… **SOSæ©Ÿèƒ½**
  - 3åˆ†ã‚¿ã‚¤ãƒãƒ¼ï¼ˆD-01ï¼‰
  - æ·±å‘¼å¸ã‚¬ã‚¤ãƒ‰ï¼ˆD-02ï¼‰
  - SOSãƒ¢ãƒ¼ãƒ€ãƒ«çµ±åˆ
  - ç¥ç¦ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
- âœ… **å±¥æ­´ãƒšãƒ¼ã‚¸**
  - æœŸé–“ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆ7æ—¥é–“/30æ—¥é–“/å…¨æœŸé–“ï¼‰
  - é€±é–“çµ±è¨ˆã‚µãƒãƒªãƒ¼
  - æœ¬æ•°æ¨ç§»ãƒãƒ£ãƒ¼ãƒˆï¼ˆç›´è¿‘7æ—¥é–“ï¼‰
  - æ—¥åˆ¥è¨˜éŒ²ã‚«ãƒ¼ãƒ‰ï¼ˆã‚¿ã‚°ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ä»˜ãï¼‰
  - è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆã‚¿ã‚°åˆ†æãƒ»ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ãƒ»ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ï¼‰
- âœ… **è¨­å®šãƒšãƒ¼ã‚¸ï¼ˆ2025-11-30ï¼‰**
  - ç›®æ¨™è¨­å®šï¼ˆæ—¥æ¬¡ç›®æ¨™æœ¬æ•°ã€è‡ªå‹•ã‚¹ãƒ†ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ï¼‰
  - ã‚³ã‚¹ãƒˆè¨­å®šï¼ˆã‚¿ãƒã‚³ä¾¡æ ¼ã€1æœ¬ã‚ãŸã‚Šè¨ˆç®—ï¼‰
  - é€šçŸ¥è¨­å®šï¼ˆãƒã‚¹ã‚¿ãƒ¼ã‚¹ã‚¤ãƒƒãƒã€4ç¨®é¡ã®é€šçŸ¥ã€ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒ¢ãƒ¼ãƒ‰ï¼‰
  - ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç®¡ç†ï¼ˆGoogleé€£æºã€ã‚µã‚¤ãƒ³ã‚¢ã‚¦ãƒˆï¼‰
- âœ… **æˆæœå¯è¦–åŒ–ãƒ‘ãƒãƒ«ï¼ˆB-03ï¼‰ï¼ˆ2025-11-30ï¼‰**
  - ç¯€ç´„é‡‘é¡è¡¨ç¤º
  - å–ã‚Šæˆ»ã—ãŸæ™‚é–“ï¼ˆå¯¿å‘½ï¼‰è¡¨ç¤º
  - æˆ‘æ…¢æˆåŠŸå›æ•°
  - è¨˜éŒ²ç¶™ç¶šæ—¥æ•°
  - çŠ¶æ³ã«å¿œã˜ãŸåŠ±ã¾ã—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- âœ… ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–å±¤ï¼ˆFirestoreçµ±åˆï¼‰

**Phase 1 ãƒã‚°ä¿®æ­£ï¼ˆ2025-12-01 å®Œäº†ï¼‰:**
- âœ… **ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ä¿®æ­£**: `lib/utils/date.ts` æ–°è¦ä½œæˆï¼ˆãƒ­ãƒ¼ã‚«ãƒ«æ™‚åˆ»ã§æ—¥ä»˜å–å¾—ï¼‰
- âœ… **SOSèªè¨¼ã‚¬ãƒ¼ãƒ‰**: `app/sos/layout.tsx` æ–°è¦ä½œæˆï¼ˆæœªèªè¨¼ã‚¢ã‚¯ã‚»ã‚¹é˜²æ­¢ï¼‰
- âœ… **è¨­å®šãƒšãƒ¼ã‚¸ä¿®æ­£**: æ•°å€¤å…¥åŠ›ã®ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒ†ãƒ¼ãƒˆç®¡ç†ã€Switch ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆä¿®æ­£
- âœ… **SOSãƒšãƒ¼ã‚¸ä¿®æ­£**: React setState ã‚¨ãƒ©ãƒ¼è§£æ¶ˆã€ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³æ”¹å–„
- âœ… **ãƒ¢ãƒ¼ãƒ€ãƒ«ä¿®æ­£**: ãƒœã‚¿ãƒ³è¦–èªæ€§æ”¹å–„ï¼ˆoutline ãƒãƒªã‚¢ãƒ³ãƒˆä½¿ç”¨ï¼‰

---

### Phase 2: PWAè¨­å®šï¼ˆWeek 5-6ï¼‰

**ç›®æ¨™:** PWAåŸºç›¤æ•´å‚™ã¨ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¯¾å¿œ

| ã‚¿ã‚¹ã‚¯ | æˆæœç‰© | çŠ¶æ…‹ |
|--------|--------|------|
| ~~æˆæœå¯è¦–åŒ–ãƒ‘ãƒãƒ«å®Ÿè£…ï¼ˆB-03ï¼‰~~ | âœ… Phase 1ã§å®Œäº†ï¼ˆ2025-11-30ï¼‰ | âœ… å®Œäº† |
| ~~çµ±è¨ˆAPIå®Ÿè£…~~ | âœ… useAchievements ãƒ•ãƒƒã‚¯å®Ÿè£…æ¸ˆã¿ | âœ… å®Œäº† |
| ~~ãƒ©ãƒ³ãƒ€ãƒ Tipså®Ÿè£…ï¼ˆB-02ï¼‰~~ | âœ… Phase 1ã§å®Œäº† | âœ… å®Œäº† |
| ~~è¨­å®šç”»é¢åŸºæœ¬å®Ÿè£…~~ | âœ… Phase 1ã§å®Œäº† | âœ… å®Œäº† |
| PWAåŸºæœ¬è¨­å®šï¼ˆmanifest.json, next-pwaï¼‰ | PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¯èƒ½ | ğŸ”´ æœªç€æ‰‹ |
| iOS ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«èª˜å°UIå®Ÿè£…ï¼ˆE-02ï¼‰ | ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚¬ã‚¤ãƒ‰ | ğŸ”´ æœªç€æ‰‹ |
| ~~ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œï¼ˆIndexedDBåŒæœŸï¼‰~~ | âœ… Phase 1ã§å®Œäº† | âœ… å®Œäº† |
| ~~ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼/å±¥æ­´è¡¨ç¤ºå®Ÿè£…ï¼ˆE-03ï¼‰~~ | âœ… Phase 1ã§å®Œäº† | âœ… å®Œäº† |

**Phase 2 å®Œäº†æ™‚ã®æ©Ÿèƒ½:**
- Phase 1 ã®å…¨æ©Ÿèƒ½ï¼ˆèªè¨¼ã€è¨˜éŒ²ã€SOSã€å±¥æ­´ã€è¨­å®šã€æˆæœå¯è¦–åŒ–ã€ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–ï¼‰
- PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆiOSå«ã‚€ï¼‰
- iOSã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚¬ã‚¤ãƒ‰

---

### Phase 3: Web Pushé€šçŸ¥ + AIã‚³ãƒ¼ãƒãƒ³ã‚°ï¼ˆWeek 4å¾ŒåŠ-6ï¼‰

**ç›®æ¨™:** Pushé€šçŸ¥ã¨AIæ©Ÿèƒ½ã«ã‚ˆã‚‹èƒ½å‹•çš„ã‚µãƒãƒ¼ãƒˆ

| ã‚¿ã‚¹ã‚¯ | æˆæœç‰© |
|--------|--------|
| Pushé€šçŸ¥åŸºç›¤æ§‹ç¯‰ï¼ˆFCM, VAPIDï¼‰ | Pushè³¼èª­æ©Ÿèƒ½ |
| é€šçŸ¥è¨±å¯èª˜å°UIå®Ÿè£…ï¼ˆE-01ï¼‰ | è¨±å¯ãƒ•ãƒ­ãƒ¼ |
| Gemini APIé€£æºåŸºç›¤ | AIæ¥ç¶š |
| AIåŠ±ã¾ã—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å®Ÿè£…ï¼ˆD-03å¼·åŒ–ï¼‰ | AIåŠ±ã¾ã—æ©Ÿèƒ½ |
| ãƒ¢ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ»ãƒ–ãƒªãƒ¼ãƒ•ã‚£ãƒ³ã‚°å®Ÿè£…ï¼ˆC-01ï¼‰ | æœé€šçŸ¥æ©Ÿèƒ½ |
| Vercel Cronè¨­å®š | å®šæœŸå®Ÿè¡Œè¨­å®š |
| é­”ã®æ™‚é–“å¸¯äºˆæ¸¬ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£… | äºˆæ¸¬ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  |
| é­”ã®æ™‚é–“å¸¯ã‚¢ãƒ©ãƒ¼ãƒˆå®Ÿè£…ï¼ˆC-02ï¼‰ | å…ˆå›ã‚Šé€šçŸ¥æ©Ÿèƒ½ |
| ç”Ÿå­˜ç¢ºèªé€šçŸ¥å®Ÿè£…ï¼ˆC-04ï¼‰ | ãƒªãƒã‚¤ãƒ³ãƒ‰é€šçŸ¥ |
| ã‚¹ãƒ†ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ææ¡ˆå®Ÿè£…ï¼ˆC-03ï¼‰ | ç›®æ¨™èª¿æ•´æ©Ÿèƒ½ |

**Phase 3 å®Œäº†æ™‚ã®æ©Ÿèƒ½:**
- Phase 2 ã®å…¨æ©Ÿèƒ½
- Web Pushé€šçŸ¥ï¼ˆiOS Safariå«ã‚€ï¼‰
- ãƒ¢ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ»ãƒ–ãƒªãƒ¼ãƒ•ã‚£ãƒ³ã‚°
- é­”ã®æ™‚é–“å¸¯ã‚¢ãƒ©ãƒ¼ãƒˆ
- AIåŠ±ã¾ã—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- å…¥åŠ›å¿˜ã‚Œãƒªãƒã‚¤ãƒ³ãƒ‰
- ç›®æ¨™è‡ªå‹•èª¿æ•´ææ¡ˆ

---

### Phase 4: å“è³ªå‘ä¸Š + è¿½åŠ æ©Ÿèƒ½ï¼ˆWeek 7-8ï¼‰

**ç›®æ¨™:** ãƒ†ã‚¹ãƒˆã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã€è¿½åŠ æ©Ÿèƒ½

| ã‚¿ã‚¹ã‚¯ | æˆæœç‰© |
|--------|--------|
| ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆè¿½åŠ  | ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ |
| E2Eãƒ†ã‚¹ãƒˆï¼ˆä¸»è¦ãƒ•ãƒ­ãƒ¼ï¼‰ | Playwrightãƒ†ã‚¹ãƒˆ |
| ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ï¼ˆLCP, CLSæ”¹å–„ï¼‰ | æœ€é©åŒ–å®Œäº† |
| ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ç›£æŸ»ãƒ»ä¿®æ­£ | WCAG AAæº–æ‹  |
| ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ– | ã‚¨ãƒ©ãƒ¼å¢ƒç•Œã€Sentry |
| ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼è¨­å®šå¼·åŒ– | é€šçŸ¥ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¨­å®š |
| ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™ | READMEã€APIä»•æ§˜æ›¸ |

---

## 7. ç’°å¢ƒå¤‰æ•°

```bash
# .env.example

# Firebase
NEXT_PUBLIC_FIREBASE_API_KEY=
NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=
NEXT_PUBLIC_FIREBASE_PROJECT_ID=
NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET=
NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=
NEXT_PUBLIC_FIREBASE_APP_ID=
FIREBASE_ADMIN_PRIVATE_KEY=

# Push Notifications
NEXT_PUBLIC_VAPID_PUBLIC_KEY=
VAPID_PRIVATE_KEY=

# Gemini AI
GEMINI_API_KEY=

# Vercel Cron
CRON_SECRET=
```

---

## 8. é–‹å§‹å‰ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] Node.js 18+ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿
- [ ] Firebase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆæ¸ˆã¿
- [ ] Vercel ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæº–å‚™æ¸ˆã¿
- [ ] Gemini API ã‚­ãƒ¼å–å¾—æ¸ˆã¿
- [ ] VAPID ã‚­ãƒ¼ãƒšã‚¢ç”Ÿæˆæ¸ˆã¿
- [ ] ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ.env.localï¼‰æº–å‚™
- [ ] Git ãƒªãƒã‚¸ãƒˆãƒªåˆæœŸåŒ–
- [ ] PWAã‚¢ã‚¤ã‚³ãƒ³æº–å‚™ï¼ˆå„ã‚µã‚¤ã‚ºï¼‰

---

## 9. å®Ÿè£…æ™‚ã®é‡è¦ãƒ•ã‚¡ã‚¤ãƒ«

| ãƒ•ã‚¡ã‚¤ãƒ« | ç”¨é€” |
|---------|------|
| `.claude/skills/swan-design-system/SKILL.md` | ãƒ‡ã‚¶ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ å®šç¾© |
| `.claude/skills/pwa-patterns/SKILL.md` | PWAå®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ |
| `docs/memo.md` | å…ƒã®æ©Ÿèƒ½ä»•æ§˜æ›¸ |
| `docs/requirements.md` | è¦ä»¶å®šç¾©æ›¸ |

---

## 10. å®Ÿè£…é€²æ—ãƒ¬ãƒãƒ¼ãƒˆ

### 2025-11-30: ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–å±¤å®Œäº† âœ…

**å®Ÿè£…å†…å®¹:**
1. **IndexedDB ã‚¹ã‚­ãƒ¼ãƒå®Ÿè£…** (`lib/indexeddb/db.ts`)
   - SwanDB ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆãƒãƒ¼ã‚¸ãƒ§ãƒ³1ï¼‰
   - 4ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆã‚¢ï¼ˆrecords, summaries, settings, syncQueueï¼‰
   - é©åˆ‡ãªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¨­å®š

2. **IndexedDB CRUDæ“ä½œ**
   - `lib/indexeddb/records.ts` - å–«ç…™è¨˜éŒ²ã®ä¿å­˜ãƒ»å–å¾—ãƒ»æ›´æ–°ãƒ»å‰Šé™¤
   - `lib/indexeddb/summaries.ts` - æ—¥åˆ¥ã‚µãƒãƒªãƒ¼ã®ç®¡ç†ãƒ»é›†è¨ˆ
   - `lib/indexeddb/settings.ts` - ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šã®æ°¸ç¶šåŒ–

3. **ã‚ªãƒ•ãƒ©ã‚¤ãƒ³åŒæœŸæ©Ÿæ§‹** (`lib/indexeddb/sync.ts`)
   - åŒæœŸã‚­ãƒ¥ãƒ¼ã®ç®¡ç†ï¼ˆè¿½åŠ ãƒ»å–å¾—ãƒ»å‰Šé™¤ï¼‰
   - ãƒªãƒˆãƒ©ã‚¤æ©Ÿæ§‹ï¼ˆæœ€å¤§3å›ï¼‰
   - é‡è¤‡æ’é™¤æ©Ÿèƒ½ï¼ˆåŒä¸€æ–‡æ›¸ã®è¤‡æ•°æ“ä½œã‚’æœ€æ–°ã«é›†ç´„ï¼‰

4. **Firestoreçµ±åˆ** (`lib/firebase/firestore.ts`)
   - 3ã¤ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆrecords, summaries, settingsï¼‰
   - å®Œå…¨ãªCRUDæ“ä½œå®Ÿè£…
   - Timestampå¤‰æ›å‡¦ç†

5. **çµ±åˆãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¤ãƒ¤ãƒ¼** (`lib/indexeddb/index.ts`)
   - Offline-firstã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
   - è‡ªå‹•åŒæœŸï¼ˆã‚ªãƒ³ãƒ©ã‚¤ãƒ³æ™‚ï¼‰
   - ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰åŒæœŸï¼ˆreconnectionæ™‚ï¼‰

6. **çµ±è¨ˆè¨ˆç®—ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£** (`lib/utils/summary.ts`)
   - æ—¥åˆ¥ã‚µãƒãƒªãƒ¼è¨ˆç®—
   - é‡‘é¡ãƒ»æ™‚é–“ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
   - æŠµæŠ—ç‡è¨ˆç®—
   - ç›®æ¨™é€²æ—ãƒã‚§ãƒƒã‚¯

7. **Reactçµ±åˆãƒ•ãƒƒã‚¯** (`hooks/useRecords.ts`)
   - IndexedDB + Firestore + Zustandçµ±åˆ
   - createRecord, updateRecord, deleteRecord API
   - åŒæœŸçŠ¶æ…‹ç®¡ç†

8. **ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰çµ±åˆ** (`app/(main)/dashboard/page.tsx`)
   - useRecordsãƒ•ãƒƒã‚¯ã®çµ±åˆ
   - ã‚ªãƒ•ãƒ©ã‚¤ãƒ³/åŒæœŸçŠ¶æ…‹è¡¨ç¤º
   - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

**ãƒ–ãƒ©ã‚¦ã‚¶ãƒ†ã‚¹ãƒˆçµæœ:**
- âœ… è¨˜éŒ²ä½œæˆãŒæ­£å¸¸ã«å‹•ä½œ
- âœ… IndexedDBã¸ã®ä¿å­˜ç¢ºèª
- âœ… Firestoreã¸ã®åŒæœŸç¢ºèª
- âœ… ã‚¿ã‚°é¸æŠæ©Ÿèƒ½å‹•ä½œ
- âœ… UIæ›´æ–°ãŒå³åº§ã«åæ˜ 

### 2025-11-30: è¨­å®šãƒšãƒ¼ã‚¸å®Ÿè£…å®Œäº† âœ…

**å®Ÿè£…å†…å®¹:**
1. **Switch UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ** (`components/ui/Switch.tsx`)
   - ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£å¯¾å¿œï¼ˆrole="switch", aria-checkedï¼‰
   - ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œå¯¾å¿œï¼ˆSpace/Enterï¼‰
   - 44pxæœ€å°ã‚¿ãƒƒãƒã‚¿ãƒ¼ã‚²ãƒƒãƒˆ
   - ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ

2. **è¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**
   - `components/settings/GoalSection.tsx` - ç›®æ¨™è¨­å®š
     - æ—¥æ¬¡ç›®æ¨™æœ¬æ•°å…¥åŠ›
     - è‡ªå‹•ã‚¹ãƒ†ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ON/OFF
   - `components/settings/CostSection.tsx` - ã‚³ã‚¹ãƒˆè¨­å®š
     - ã‚¿ãƒã‚³ä¾¡æ ¼ï¼ˆ1ç®±ã‚ãŸã‚Šï¼‰
     - 1ç®±ã®æœ¬æ•°
     - 1æœ¬ã‚ãŸã‚Šä¾¡æ ¼ã®è‡ªå‹•è¨ˆç®—è¡¨ç¤º
   - `components/settings/NotificationSection.tsx` - é€šçŸ¥è¨­å®š
     - ãƒã‚¹ã‚¿ãƒ¼ã‚¹ã‚¤ãƒƒãƒï¼ˆé€šçŸ¥å…¨ä½“ã®ON/OFFï¼‰
     - 4ç¨®é¡ã®é€šçŸ¥ï¼ˆãƒ¢ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ»ãƒ–ãƒªãƒ¼ãƒ•ã‚£ãƒ³ã‚°ã€é­”ã®æ™‚é–“å¸¯ã‚¢ãƒ©ãƒ¼ãƒˆã€ã‚¹ãƒ†ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ææ¡ˆã€ç”Ÿå­˜ç¢ºèªï¼‰
     - ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒ¢ãƒ¼ãƒ‰ï¼ˆæ±ç”¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä½¿ç”¨ï¼‰
     - ã‚µã‚¤ãƒ¬ãƒ³ãƒˆæ™‚é–“è¨­å®šï¼ˆé–‹å§‹ãƒ»çµ‚äº†æ™‚åˆ»ï¼‰
   - `components/settings/AccountSection.tsx` - ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç®¡ç†
     - ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç¨®åˆ¥è¡¨ç¤ºï¼ˆåŒ¿å/Googleï¼‰
     - Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆé€£æºï¼ˆåŒ¿åãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å ´åˆï¼‰
     - ã‚µã‚¤ãƒ³ã‚¢ã‚¦ãƒˆï¼ˆç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ«ä»˜ãï¼‰
     - ãƒ‡ãƒ¼ã‚¿å–ªå¤±è­¦å‘Šï¼ˆåŒ¿åãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ï¼‰

3. **è¨­å®šãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸** (`app/(main)/settings/page.tsx`)
   - 4ã¤ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’çµ±åˆ
   - IndexedDBã‹ã‚‰ã®è¨­å®šèª­ã¿è¾¼ã¿
   - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ä¿å­˜ï¼ˆIndexedDB + FirestoreåŒæœŸï¼‰
   - ä¿å­˜ç¢ºèªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºï¼ˆã€Œä¿å­˜ã—ã¾ã—ãŸ âœ“ã€ï¼‰
   - ä¿å­˜ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

**ãƒ–ãƒ©ã‚¦ã‚¶ãƒ†ã‚¹ãƒˆçµæœ:**
- âœ… ã™ã¹ã¦ã®è¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒæ­£ã—ãè¡¨ç¤º
- âœ… ã‚¹ã‚¤ãƒƒãƒã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å‹•ä½œç¢ºèª
- âœ… ä¿å­˜æ©Ÿèƒ½ã®å‹•ä½œç¢ºèªï¼ˆã€Œä¿å­˜ã—ã¾ã—ãŸ âœ“ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºï¼‰
- âœ… ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œç¢ºèª
- âœ… ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ç¢ºèª

**Phase 1 å®Œå…¨å®Œäº†:**
- âœ… ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–å±¤ï¼ˆIndexedDB + Firestoreï¼‰
- âœ… SOSæ©Ÿèƒ½ï¼ˆ3åˆ†ã‚¿ã‚¤ãƒãƒ¼ãƒ»æ·±å‘¼å¸ãƒ¢ãƒ¼ãƒ‰ï¼‰
- âœ… å±¥æ­´ãƒšãƒ¼ã‚¸ï¼ˆæœŸé–“ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ»çµ±è¨ˆãƒ»ãƒãƒ£ãƒ¼ãƒˆãƒ»è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼‰
- âœ… è¨­å®šãƒšãƒ¼ã‚¸ï¼ˆç›®æ¨™ãƒ»ã‚³ã‚¹ãƒˆãƒ»é€šçŸ¥ãƒ»ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç®¡ç†ï¼‰

**æ¬¡ã®ãƒ•ã‚§ãƒ¼ã‚º: Phase 2**
- æˆæœå¯è¦–åŒ–ãƒ‘ãƒãƒ«å®Ÿè£…ï¼ˆB-03ï¼‰
- PWAåŸºæœ¬è¨­å®šï¼ˆmanifest.json, Service Workerï¼‰
- iOSã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«èª˜å°UI

---

## 11. æ”¹è¨‚å±¥æ­´

| ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | æ—¥ä»˜ | å¤‰æ›´å†…å®¹ |
|-----------|------|---------|
| 1.2.0 | 2025-11-30 | Phase 1å®Œå…¨å®Œäº†ï¼ˆè¨­å®šãƒšãƒ¼ã‚¸å®Ÿè£…ï¼‰ã€å®Ÿè£…é€²æ—ãƒ¬ãƒãƒ¼ãƒˆæ›´æ–° |
| 1.1.0 | 2025-11-30 | ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–å±¤å®Ÿè£…å®Œäº†ã€å®Ÿè£…é€²æ—ãƒ¬ãƒãƒ¼ãƒˆè¿½åŠ  |
| 1.0.0 | 2025-11-30 | åˆç‰ˆä½œæˆ |
